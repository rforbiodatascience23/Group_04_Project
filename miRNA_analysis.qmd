---
title: "miRNA_analysis"
format: html
editor: visual
---

## Set Working directory

```{r setup}
own_path <- "/Users/kseniakirdey/Desktop/DTU/R_for_bio_data_science/lab_10_Project"
knitr::opts_knit$set(root.dir = paste0(own_path, "/group_04_project/data/"))
```

## Load Libraries

```{r}
library(tidyverse)
library(ggrepel)
```

## Fetch dataset

```{r}
miRNA_log_long_full <- readRDS(paste0(own_path, "/group_04_project/data/miRNA_log_long_full.RDS"))
top_genes_stat <- readRDS(paste0(own_path, "/group_04_project/data/top_genes_stat.RDS"))
```

Subsetting top 25 "log Fold Changed" genes for a better visualisation:

```{r}
top_genes_stat_subset <- top_genes_stat |>
  arrange(desc(abs(logFC))) |>
  head(n = 25)

top_genes <- top_genes_stat_subset$genes
```

-   Comment that the samples should be taken from cancer + normal tissues of the same patients to get a proper overview of the expr.difference

-   For some genes, depending on the cancer behaviour, they might become up- or down-regulated, so this causes the spreading of some data points without a clear distinction from the normal tissues.

```{r}
miRNA_log_long_full |>
  filter(miRNA_ID %in% top_genes) |>
  ggplot(aes(x = miRNA_ID,
             y = log_reads,
             col = Status)) +
  geom_point() +
  labs(title = "Comparison of expression of 25 top differentially expressed miRNAs \nbetween cancer and normal TCGA samples", color = "Tissue Type",
       x = "miRNA IDs",
       y = "Log2 expression") +
  theme(axis.text.x = element_text(
    angle = 45,
    hjust = 1),
    plot.title = element_text(
      size = 12, 
      angle = 0)) +
  facet_wrap(~gender)
```

```{r}
# calculate adjusted pvalue
top_genes_stat <- top_genes_stat |>
    mutate(
      q.value = p.adjust(PValue),
      significance = case_when(
        q.value > 0.05 ~ "no",
        q.value <= 0.05 ~ "yes"
      )
    )
```

```{r}
# volcano plot
top_genes_stat |> 
  ggplot(aes(x = logFC,
             y = -log10(PValue),
             col = significance)) +
  geom_point(alpha = 0.4) +
  theme_minimal() +
  labs(x = "Log Fold Change",
       y = "-log10(p-value)",
       title = "Top Differentially Expressed miRNAs in TCGA-COAD Samples") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5)) +
  geom_text_repel(data = top_genes_stat_subset,
                  aes(label = genes),
                      color = "black")
```

## Clean environment

```{r}
rm(miRNA_log_long_full)
rm(top_genes_stat)
rm(top_genes_stat_subset)
rm(top_genes)
```
